import{d as T,r as E,c as O,a as k,o as x,b as w,e as N,f as u,g as I,E as b,h as L,i as B,N as m,j as C,k as $}from"./vendor.eb21e818.js";const M=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}};M();var q=(e,t)=>{const o=e.__vccOpts||e;for(const[n,s]of t)o[n]=s;return o};const D=T({name:"App",setup(){return{isCollapse:E(!1),route:{path:"/about"},handleOpen:(s,r)=>{console.log(s,r)},handleClose:(s,r)=>{console.log(s,r)}}}});function j(e,t,o,n,s,r){const i=k("router-view");return x(),O(i)}var K=q(D,[["render",j]]);const U="modulepreload",v={},F="/",J=function(t,o){return!o||o.length===0?t():Promise.all(o.map(n=>{if(n=`${F}${n}`,n in v)return;v[n]=!0;const s=n.endsWith(".css"),r=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${r}`))return;const i=document.createElement("link");if(i.rel=s?"stylesheet":U,s||(i.as="script",i.crossOrigin=""),i.href=n,document.head.appendChild(i),s)return new Promise((c,A)=>{i.addEventListener("load",c),i.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())};function V(e){switch(e){case"../../views/add.vue":return J(()=>import("./add.b5debf36.js"),["assets/add.b5debf36.js","assets/vendor.eb21e818.js"]);default:return new Promise(function(t,o){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+e)))})}}let g=[{component:"layout/index",redirect:{name:"dashboard"},meta:{title:"\u4EEA\u8868\u76D8",icon:"el-icon-data-analysis"},children:[{name:"dashboard",component:"dashboard/index",meta:{title:"\u4EEA\u8868\u76D8",icon:"el-icon-data-analysis"}}]},{name:"goods",component:"layout/index",meta:{title:"\u83DC\u54C1\u7BA1\u7406",icon:"el-icon-data-analysis"},children:[{component:"goods/list",meta:{title:"\u83DC\u54C1\u5217\u8868"}},{component:"goods/add",meta:{title:"\u65B0\u589E\u83DC\u54C1"}},{component:"goods/set",meta:{title:"\u65B0\u589E\u83DC\u54C11"}}]},{name:"image",component:"layout/index",meta:{title:"\u4E91\u76F8\u518C",icon:"el-icon-picture"},children:[{meta:{title:"\u4E91\u76F8\u518C",icon:"el-icon-picture"},component:"image/index"}]},{meta:{title:"\u7BA1\u7406\u5458",icon:"el-icon-data-analysis"},component:"admin/index"},{component:"login/index",meta:{hidden:!0}},{path:"/:pathMatch(.*)*",redirect:{name:"dashboard"},meta:{title:"404",hidden:!0}}];function W(){return _(g),console.log(g),g}function _(e){for(let t=0;t<e.length;t++){if(!e[t].component)return;let o=H(e[t].component);e[t].name=e[t].name||o.replace(/\//g,"_"),e[t].path=e[t].path||`/${o}`;let n=V(`../../views/${e[t].component}.vue`);e[t].component=()=>n,e[t].children&&e[t].children.length>0&&_(e[t].children)}}function H(e){let t=e.lastIndexOf("/");return e.substring(t+1,e.length)==="index"?e.substring(t,-1):e}var X=W();const l=X,h=[],a=w({history:N(),routes:l}),P="Admin-Token";function f(){return u.get(P)}function Y(e){return u.set(P,e)}const p=I.create({baseURL:"http://127.0.0.1:7001",timeout:5e3});p.interceptors.request.use(e=>(d.getters.token&&(e.headers["X-Token"]=f()),e),e=>(console.log(e),Promise.reject(e)));p.interceptors.response.use(e=>{const t=e.data;return t.code!==0?(b({message:t.message||"Error",type:"error",duration:5*1e3}),(t.code===50008||t.code===50012||t.code===50014)&&L.confirm("You have been logged out, you can cancel to stay on this page, or log in again","Confirm logout",{confirmButtonText:"Re-Login",cancelButtonText:"Cancel",type:"warning"}).then(()=>{d.dispatch("user/resetToken").then(()=>{location.reload()})}),Promise.reject(new Error(t.message||"Error"))):t},e=>(b({message:e.message,type:"error",duration:5*1e3}),Promise.reject(e)));function z(e){return p({url:"/signin",method:"post",data:e})}const G={token:f(),name:"",avatar:"",introduction:"",roles:[]},Q={getName(e){return e.name}},Z={setName(e,t){e.name=t},SET_TOKEN(e,t){e.token=t}},ee={loginByUsername({commit:e},t){const{username:o,password:n}=t;return new Promise((s,r)=>{z({username:o.trim(),password:n}).then(i=>{const{token:c}=i;e("SET_TOKEN",c),Y(c),s()}).catch(i=>{r(i)})})}};var te={namespaced:!0,state:G,getters:Q,mutations:Z,actions:ee};const oe={namespaced:!0,state:{sidebar:{opened:u.get("sidebarStatus")?!!u.get("sidebarStatus"):!0,withoutAnimation:!1},device:"desktop"},mutations:{toggle_sidebar:e=>{e.sidebar.opened=!e.sidebar.opened,e.sidebar.withoutAnimation=!1,e.sidebar.opened?u.set("sidebarStatus",1):u.set("sidebarStatus",0)},close_sidebar:(e,t)=>{u.set("sidebarStatus",0),e.sidebar.opened=!1,e.sidebar.withoutAnimation=t},toggle_device:(e,t)=>{e.device=t}},actions:{toggleSideBar({commit:e}){e("toggle_sidebar")},closeSideBar({commit:e},{widthoutAnimation:t}){e("close_sidebar",t)},toggleDevice({commit:e},t){e("toggle_device",t)}},getters:{getSidebarState(e){return e.sidebar.opened},getSidebarAnimation(e){return e.sidebar.withoutAnimation},getDeviceState(e){return e.device}}},y={queryAuthedPermission:"/api/auth/permission/routes",queryPermissions:"/api/auth/permission/permissions"};class R{static postAuthPermission(t){return p({url:y.queryAuthedPermission,method:"POST",json:!0,data:t}).then(o=>o.status===0?Promise.resolve(o):Promise.reject(o))}static postPermissions(t){return p({url:y.queryPermissions,method:"POST",json:!0,data:t}).then(o=>o.status===0?Promise.resolve(o):Promise.reject(o))}}const se=localStorage.getItem("role")||"",ne={namespaced:!0,state:{roles:se,permissions:[],accessRoutes:l,routes:l,authedRoutes:[]},mutations:{setRoles:(e,{roleName:t})=>{e.roles=t,console.log(e.roles)},setAccessRoutes:(e,t)=>{e.accessRoutes=l.concat(t)},setRoutes:(e,t)=>{e.routes=l.concat(t)},setAuthedRoutes:(e,t=[])=>{e.authedRoutes=t,localStorage.setItem("authedRoutes",JSON.stringify(t))},setPermissions:(e,t=[])=>{e.permissions=t}},actions:{getPermissonRoutes({commit:e},t){const o={roleName:t.roleName};R.postAuthPermission(o).then(n=>{const{authedRoutes:s}=n.data;e("setAuthedRoutes",s);const r=[];for(const i of s)for(const c of h)c.path===i&&r.push(c);a.isReady().then(()=>{r.forEach(i=>{const c=i.name;a.hasRoute(c)||a.addRoute(i)}),a.options.routes=l.concat(h),console.log(a),e("setAccessRoutes",r)})})},getPermissions({commit:e}){R.postPermissions({}).then(t=>{const{permissions:o}=t.data;e("setPermissions",o)})},getRoutes({commit:e}){if(localStorage.getItem("authedRoutes")){const t=JSON.parse(localStorage.getItem("authedRoutes")),o=[];for(const n of t)for(const s of h)s.path===n&&o.push(s);o.forEach(n=>{const s=n.name;a.hasRoute(s)||a.addRoute(n)})}e("setRoutes",h)},getPermissonRoles({commit:e},t){localStorage.setItem("role",t.roleName),e("setRoles",t)}},getters:{getAccessRoutes(e){return e.routes},authedRoutes(e){return e.authedRoutes},getRoles(e){return e.roles},getPermission(e){return e.permissions}}},re={namespaced:!0,state:{tabsOption:[{route:"/dashboard",title:"\u4EEA\u8868\u76D8",name:"dashboard"}],currentIndex:"dashboard",breadcrumbList:[]},mutations:{ADD_TAB:(e,t)=>{e.tabsOption.push(t)},DELETE_TAB:(e,t)=>{const o=e.tabsOption.findIndex(n=>n.route===t);e.tabsOption.splice(o,1)},SET_TAB:(e,t)=>{e.currentIndex=t}},actions:{},getters:{getCurrentIndex(e){return e.currentIndex},getTabsOption(e){return e.tabsOption}}},ie=B({modules:{user:te,appModule:oe,permissionModule:ne,tabModule:re}});var d=ie;m.configure({showSpinner:!1});const ae=["/login","/auth-redirect"];a.beforeEach(async(e,t,o)=>{!(d.getters["tabModule/getTabsOption"].findIndex(i=>i.route===e.path)>-1)&&!e.meta.hidden&&d.commit("tabModule/ADD_TAB",{route:e.path,title:e.meta.title,name:e.name}),d.commit("tabModule/SET_TAB",e.path),m.start(),f()?e.path==="/login"?(o("/"),m.done()):o():ae.indexOf(e.path)!==-1?(console.log("whiteList"),o()):(o(`/login?redirect=${e.path}`),m.done())});a.afterEach(()=>{m.done()});const S=C(K);S.use(a).use(d).use($);a.isReady().then(()=>S.mount("#app"));export{q as _};
